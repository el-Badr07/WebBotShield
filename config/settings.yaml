# WebBotShield - Centralized Configuration

# Kafka Configuration
kafka:
  bootstrap_servers: "kafka:29092"
  topic: "nginx-logs"
  group_id: "webshield-bot-detector"
  auto_offset_reset: "latest"

# Elasticsearch Configuration
elasticsearch:
  host: "elasticsearch"
  port: 9200
  logs_index: "webshield-logs"
  detections_index: "webshield-detections"
  bulk_size: 1000
  timeout: 30

# Bot Detection Thresholds
detection:
  # Request burst detection
  burst_threshold: 100  # requests per minute to trigger burst alert
  burst_window: "1 minute"

  # Error ratio detection
  error_ratio_threshold: 0.5  # 50% error rate to trigger alert
  error_window: "5 minutes"

  # Time windows for analysis
  window_duration: "1 minute"
  slide_duration: "30 seconds"
  watermark_delay: "10 minutes"

  # Bot scoring
  bot_score_threshold: 0.7  # Threshold to classify as bot (0-1 scale)

  # Scoring weights (must sum to 1.0)
  weights:
    burst: 0.4
    error: 0.3
    user_agent: 0.3

# User-Agent Patterns
user_agent:
  # Known bot patterns (case-insensitive)
  bot_patterns:
    - "bot"
    - "crawler"
    - "spider"
    - "scraper"
    - "curl"
    - "wget"
    - "python-requests"
    - "scrapy"
    - "java"
    - "go-http-client"
    - "apache-httpclient"
    - "libwww"
    - "mechanize"
    - "selenium"
    - "phantom"

  # Legitimate bots (optional whitelist)
  whitelist:
    - "googlebot"
    - "bingbot"
    - "slackbot"

# Spark Configuration
spark:
  app_name: "WebBotShield-BotDetector"
  checkpoint_location: "/tmp/webshield-checkpoint"
  log_level: "WARN"

  # Streaming configuration (reduced for low-resource servers)
  streaming:
    trigger_interval: "60 seconds"  # Increased from 30s
    max_offsets_per_trigger: 1000   # Reduced from 10000

  # Performance tuning (low-resource)
  executor:
    memory: "256m"
    cores: 1

  driver:
    memory: "256m"

# ML Model Configuration
ml:
  # Path to trained model (inside Docker container)
  model_path: "/opt/spark-apps/models/webbotshield_bot_detector.joblib"
  scaler_path: "/opt/spark-apps/models/scaler.joblib"
  feature_names_path: "/opt/spark-apps/models/feature_names.txt"
  
  # Prediction settings
  prediction_threshold: 0.5  # Probability threshold for bot classification
  
  # Feature engineering windows
  window_duration: "60 seconds"
  slide_duration: "30 seconds"
  
  # Feature list (must match training)
  features:
    - Port
    - Request_Type
    - Protocol
    - Payload_Size
    - requests_per_ip
    - failure_rate_per_ip
    - avg_payload_per_ip
    - payload_std_per_ip
    - time_since_last_request
    - inter_arrival_std
    - ua_is_empty
    - ua_is_tool
    - ua_is_browser
    - is_encrypted
    - is_failure
    - protocol_error_rate

# Logging Configuration
logging:
  level: "INFO"
  format: "[%(asctime)s] %(levelname)s - %(message)s"
  output:
    console: true
    file: true
    file_path: "logs/webshield.log"

# Alerting Configuration (for future implementation)
alerting:
  enabled: false
  channels:
    - type: "console"
    - type: "email"
      recipients: []
    - type: "slack"
      webhook_url: ""

# Development/Testing Configuration
development:
  sample_data: true
  debug_mode: false
  mock_kafka: false
